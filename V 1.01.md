import maya.cmds as cmds
import random

# متغیر سراسری برای ذخیره گروه ابر
cloud_group = None

def create_cloud(*args):
    global cloud_group

    # دریافت مقدار density انتخاب شده
    density = cmds.radioButtonGrp("densityRadio", query=True, select=True)

    # اگر گروه ابر از قبل وجود دارد، از آن استفاده کنیم
    if cloud_group is None:
        cloud_group = cmds.group(em=True, name="cloud_group")  # گروه ابر جدید

    # شعاع کره‌های ابر
    cloud_radius = random.uniform(1.0, 1.5)  # اندازه رندوم برای هر کره (محدوده محدود)

    # موقعیت تصادفی برای کره‌ها
    x = random.uniform(-10, 10)
    y = random.uniform(10, 20)  # ارتفاع بالای درخت‌ها
    z = random.uniform(-10, 10)

    # بر اساس density تعداد کره‌ها را تنظیم می‌کنیم
    if density == 1:  # Low
        spheres = [create_sphere(x, y, z, cloud_radius)]
    elif density == 2:  # Medium
        spheres = [
            create_sphere(x, y, z, cloud_radius),
            create_sphere(x + cloud_radius * 1.2, y, z, cloud_radius)  # فاصله کمتر بین کره‌ها
        ]
    else:  # High
        spheres = [
            create_sphere(x, y, z, cloud_radius),
            create_sphere(x + cloud_radius * 1.2, y, z, cloud_radius * 1.3),  # کره وسطی بزرگتر از دو کره کناری
            create_sphere(x + cloud_radius * 2.4, y, z, cloud_radius)
        ]

    # افزودن کره‌ها به گروه ابر
    for sphere in spheres:
        cmds.parent(sphere, cloud_group)

    cmds.select(cloud_group)

def create_sphere(x, y, z, radius):
    # ایجاد کره با شعاع مشخص و موقعیت داده شده
    sphere = cmds.polySphere(r=radius, sx=6, sy=4)[0]
    cmds.move(x, y, z, sphere)

    # اندازه تصادفی برای کره (با محدوده محدودتر)
    scale_factor = random.uniform(0.9, 1.2)  # مقیاس رندوم محدود
    cmds.scale(scale_factor, scale_factor, scale_factor, sphere)  # اعمال مقیاس به کره

    # اعمال متریال سفید مایل به آبی
    material = cmds.shadingNode('lambert', asShader=True)
    shading_group = cmds.setAttr(f'{material}.color', 0.8, 0.9, 1.0, type='double3')  # رنگ سفید مایل به آبی
    cmds.select(sphere)
    cmds.hyperShade(assign=material)

    return sphere

def create_ui():
    if cmds.window("treeWindow", exists=True):
        cmds.deleteUI("treeWindow", window=True)

    # ایجاد پنجره UI
    window = cmds.window("treeWindow", title="Tree Generator", widthHeight=(350, 250))
    cmds.columnLayout(adjustableColumn=True)

    # عنوان
    cmds.text(label="Choose Tree Type")

    # دکمه‌های انتخاب درخت
    cmds.radioButtonGrp("treeType", label1="Normal Tree", label2="Casual Tree", numberOfRadioButtons=2, select=1)

    # منوهای انتخاب ارتفاع
    cmds.optionMenu("heightMenu", label="Tree Height")
    cmds.menuItem(label="Short")  # 3 واحد
    cmds.menuItem(label="Normal") # 5 واحد
    cmds.menuItem(label="Tall")   # 7 واحد

    # منوهای انتخاب قطر تنه
    cmds.optionMenu("diameterMenu", label="Trunk Diameter")
    cmds.menuItem(label="Thin")   # 0.2 واحد
    cmds.menuItem(label="Medium") # 0.3 واحد
    cmds.menuItem(label="Fat")    # 0.5 واحد

    # دکمه ساخت درخت
    cmds.button(label="Create Tree", command=lambda x: create_tree(
        cmds.radioButtonGrp("treeType", query=True, select=True) == 2,
        get_selected_height(),
        get_selected_diameter(),
        get_selected_tree_height_type()
    ))

    # انتخاب density
    cmds.text(label="Choose Cloud Density")
    cmds.radioButtonGrp("densityRadio", label1="Low", label2="Medium", label3="High", numberOfRadioButtons=3, select=1)

    # دکمه ساخت ابر
    cmds.button(label="Create Cloud", command=create_cloud)

    cmds.showWindow(window)

def get_selected_height():
    selected_height = cmds.optionMenu("heightMenu", query=True, value=True)
    if selected_height == "Short":
        return 3
    elif selected_height == "Normal":
        return 5
    elif selected_height == "Tall":
        return 7

def get_selected_diameter():
    selected_diameter = cmds.optionMenu("diameterMenu", query=True, value=True)
    if selected_diameter == "Thin":
        return 0.2
    elif selected_diameter == "Medium":
        return 0.3
    elif selected_diameter == "Fat":
        return 0.5

def get_selected_tree_height_type():
    return cmds.optionMenu("heightMenu", query=True, value=True)

create_ui()
